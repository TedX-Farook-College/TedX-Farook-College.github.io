<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tedx FC</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        display: flex;
        flex-direction: column;
      }

      main {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      footer {
        text-align: center;
        padding: 10px;
        margin-top: auto;
      }

      .error-message {
        color: red;
        font-size: 10px;
      }

      .step {
        display: none;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease-in-out;
      }

      .step.active {
        display: block;
        opacity: 1;
        transform: translateX(0);
      }
      * {
        box-sizing: border-box;
      }
      body {
        background-color: black;
        margin: 0;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        background-image: url("./assets/Frame.png");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }

      .form-container {
        width: 100%;
        max-width: 420px;
        background-color: rgba(12, 12, 12, 0.8);
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        border: 1px solid #ff5050;
        border-radius: 10px;
      }

      h2 {
        margin-top: 5px;
        color: #eeeeee;
        font-weight: 500;
        font-size: 22px;
        text-align: left;
        margin-bottom: 0px;
      }

      h3 {
        font-weight: 100;
        text-align: left;
        margin-bottom: 15px;
        font-size: 13px;
        color: #eeeeee;
      }

      hr {
        border: 1px solid #ccc;
        margin: 15px 0 15px 0;
      }

      .form-group {
        text-align: left;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-size: 12px;
      }

      input {
        margin-bottom: 10px;
      }

      select,
      input[type="text"],
      input[type="email"],
      input[type="tel"] {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: white;
        color: black;
        box-sizing: border-box;
        font-size: 14px;
      }

      select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        position: relative;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='%23000000' d='M2 0L0 2h4z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 10px;
        padding-right: 30px;
      }

      input::placeholder {
        color: gray;
      }

      .button {
        border: none;
        width: 100%;
        padding: 12px;
        margin-top: 20px;
        background-color: #222020;
        color: white;
        text-align: center;
        text-decoration: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        display: inline-block;
        box-sizing: border-box;
      }

      .button:hover {
        background-color: #ed525269;
      }

      /*step 2*/
      .heading {
        font-weight: bold;
        text-align: left;
        font-size: 24px;
      }

      .subheading {
        margin-top: 10px;
        font-weight: normal;
        font-size: 16px;
        text-align: left;
      }

      .divider {
        margin-top: 15px;
        margin-bottom: 20px;
        height: 1px;
        background: #fff;
      }

      .ticket-option {
        margin-bottom: 15px;
        background: rgb(249 249 249 / 7%);
        border: 2px solid transparent;
        border-radius: 8px;
        cursor: pointer;
        transition: border-color 0.3s ease;
      }

      .ticket-option:hover {
        border-color: #ff5050;
      }

      .ticket-option.selected {
        border-color: #fff;
      }

      .ticket-info h3 {
        font-weight: normal;
        text-align: center;
        font-size: 20px;
        margin-top: 15px;
      }

      .ticket-info h2 {
        font-weight: bold;
        text-align: center;
        font-size: 32px;
        margin: 10px 0;
      }

      .description p {
        text-align: left;
        font-size: 12px;
        margin: 5px 0px 10px 10px;
      }

      .button-container {
        display: flex;
        justify-content: space-between;
        gap: 10px; /* Adds spacing between buttons */
      }

      .button-container button {
        flex: 1;
        padding: 10px;
        background: rgb(249 249 249 / 7%);
        color: #fff;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .button-container button:hover {
        background: #ff2e2e;
      }

      @media (max-width: 768px) {
        .heading {
          font-size: 20px;
        }

        .subheading {
          margin-top: 10px;
          margin-bottom: 10px;
          font-size: 12px;
        }

        .ticket-info h2 {
          text-align: center;
          padding: 10px;
          margin: 0px;
          font-weight: 600;
          font-size: 32px;
        }

        .ticket-info h3 {
          font-weight: normal;
          text-align: center;
          padding-top: 10px;
          font-weight: 100;
          font-size: 16px;
        }

        .description p {
          font-weight: 100;
          margin: 0px;
          padding-left: 10px;
          padding-bottom: 10px;
          text-align: left;
          font-size: 10px;
        }
      }
      sup {
        font-size: 22px;
      }

      /* Responsive adjustments for 1st section*/
      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .form-container {
          padding: 20px;
          width: 100%;
          max-width: 400px;
        }

        h2 {
          font-size: 22px;
        }

        h3 {
          font-size: 12px;
        }

        .button {
          font-size: 15px;
        }
      }

      @media (max-width: 480px) {
        .form-container {
          padding: 20px;
          max-width: 350px;
          margin: 0px 0px;
        }

        h2 {
          margin: 10px 0px 10px 0px;
          font-weight: 500;
          font-size: 22px;
        }

        h3 {
          font-weight: 100;
          line-height: 16px;
          margin: 0px;
          font-size: 11.5px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select {
          margin-bottom: 10px;
          font-size: 12px;
          padding: 8px;
        }

        .button {
          margin: 10px 0px 5px 0px;
          padding: 10px;
          font-size: 14px;
        }
        body {
          padding-left: 25px;
          padding-right: 25px;
        }
      }

      /* Phone Input Container */
      .phone-input-container {
        display: flex;
        align-items: flex-start; /* Aligns items vertically in the center */
        gap: 10px; /* Adds spacing between the dropdown and input */
        width: 100%; /* Full width of the container */
        margin-top: 6px;
      }

      /* Country Code Dropdown */
      .country-code {
        flex: 0 0 auto; /* Prevents shrinking or growing */
        width: 70px; /* Sets a consistent width */
        padding: 10px 5px; /* Padding adjusted for better spacing */
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        background-color: white;
        text-align: left;
      }

      /* Phone Number Input */
      .phone-number {
        flex: 1; /* Takes up remaining space */
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }

      /* Focus Styles */
      .phone-input-container select:focus,
      .phone-input-container input:focus {
        border-color: #007bff;
        outline: none;
        box-shadow: 0 0 4px rgba(0, 123, 255, 0.5);
      }

      /* Responsive Adjustments for Small Screens */
      @media (max-width: 500px) {
        .phone-input-container {
          gap: 8px;
          justify-content: center;
        }

        .country-code {
          font-size: 13px;
          padding: 8px 2px;
          width: 65px;
          /* Full width on small screens */
        }

        .phone-number {
          padding: 5px;
        }
      }

      @media (max-width: 365px) {
        .phone-input-container {
          gap: 8px;
          justify-content: center;
        }

        .country-code {
          font-size: 11px;

          width: 55px;
          /* Full width on small screens */
        }

        .phone-number {
          padding: 5px;
        }
      }

      .error-message-container {
        display: none;
        padding: 5px;
        margin-bottom: 15px;
        color: white;

        border-radius: 5px;
        font-size: 25px;
        font-weight: 600;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <main>
      <!-- Step 1 -->
      <div class="form-container">
        <div id="step-1" class="step active">
          <h2>Participant Registration Form</h2>
          <h3>
            Please fill the form below keenly and let us know if you give go
            ahead for this participation
          </h3>
          <hr />
          <form id="step1Form">
            <div class="form-group">
              <label for="name">Name:</label>
              <input
                type="text"
                id="name"
                name="name"
                required
                placeholder="Full Name"
              />
              <span class="error-message" id="nameError"></span>
            </div>

            <div class="form-group">
              <label for="phone">Phone:</label>
              <div class="phone-input-container">
                <select
                  id="countryCode"
                  name="countryCode"
                  class="country-code"
                >
                  <option value="+91" selected>+91</option>
                </select>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  required
                  placeholder="Phone Number"
                  class="phone-number"
                />
              </div>
              <span class="error-message" id="phoneError"></span>
            </div>

            <div class="form-group">
              <label for="email">Email:</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="Email"
              />
              <span class="error-message" id="emailError"></span>
            </div>

            <div class="form-group">
              <label for="category">Category:</label>
              <select
                id="category"
                name="category"
                onchange="hideDummyOption()"
              >
                <option value="" disabled selected>Select an option</option>
                <option value="Veg">Veg</option>
                <option value="Non Veg">Non Veg</option>
              </select>
            </div>

            <button type="button" id="next-btn" class="button">Next</button>
          </form>
        </div>
        <!-- Step 2 -->
        <div id="step-2" class="step container">
          <div class="heading">Ticket Type</div>
          <div class="subheading">
            Select a ticket type to register for the event.
          </div>

          <div class="divider"></div>
          <form id="step2Form">
            <div
              class="ticket-card ticket-option"
              data-value="TEDx General"
              onclick="selectTicket(this)"
            >
              <div class="ticket-info">
                <h3>General Ticket</h3>
                <h2><sup>₹</sup>800</h2>
              </div>
              <div class="description">
                <p>• General Tedx ticket*</p>
              </div>
            </div>

            <div
              class="ticket-card ticket-option"
              data-value="Farookians"
              onclick="selectTicket(this)"
            >
              <div class="ticket-info">
                <h3>Student Ticket</h3>
                <h2><sup>₹</sup>600</h2>
              </div>
              <div class="description">
                <p>• Only for College students*</p>
                <p>• Bring your student ID for entry*</p>
              </div>
            </div>

            <input type="hidden" id="ticketType" name="ticketType" />

            <div class="button-container">
              <button type="button" id="backButton">Back</button>
              <button type="submit" id="submit-button">Pay Now!</button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <div id="errorMessage" class="error-message-container">hello</div>

    <footer>
      <p style="font-size: smaller">
        Form Powered by
        <a style="text-decoration: none" href="https://makemypass.com/"
          >MakeMyPass</a
        >
      </p>
    </footer>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      function hideDummyOption() {
        const selectElement = document.getElementById("category");
        const dummyOption = selectElement.querySelector('option[value=""]');

        if (selectElement.value !== "") {
          dummyOption.style.display = "none"; // Hide the dummy option
        }
      }

      // Function to handle ticket selection
      function selectTicket(card) {
        // Remove 'selected' class from all ticket cards
        const allCards = document.querySelectorAll(".ticket-card");
        allCards.forEach((c) => c.classList.remove("selected"));

        // Add 'selected' class to the clicked card
        card.classList.add("selected");

        // Get the value of the selected ticket and set the hidden input
        ticketType = card.getAttribute("data-value");

        document.getElementById("ticketType").value = ticketType;
      }
      document.addEventListener("DOMContentLoaded", function () {
        const errorMessage = document.getElementById("errorMessage");
        const step1 = document.getElementById("step-1");
        const step2 = document.getElementById("step-2");
        const nextBtn = document.getElementById("next-btn");
        const backButton = document.getElementById("backButton");
        const submitButton = document.getElementById("submit-button");

        const nameInput = document.getElementById("name");
        const countryCodeSelect = document.getElementById("countryCode");
        const phoneInput = document.getElementById("phone");
        const emailInput = document.getElementById("email");
        const nameError = document.getElementById("nameError");
        const phoneError = document.getElementById("phoneError");
        const emailError = document.getElementById("emailError");

        const namePattern = /^[A-Za-z\s]+$/;
        const phonePattern = /^[0-9]{10}$/;
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        let ticketType = "";

        nameInput.addEventListener("input", () => {
          nameError.textContent =
            nameInput.value.trim() === ""
              ? "Name is required*"
              : !namePattern.test(nameInput.value)
              ? "Name can only contain letters and spaces."
              : nameInput.value.length < 2
              ? "Name must be at least 2 characters*"
              : "";
        });

        fetch("phoneCountryCodes.json")
          .then((response) => response.json())
          .then((data) => {
            // Populate the country code dropdown
            data.forEach((country) => {
              const option = document.createElement("option");
              option.value = country.dial_code;
              option.textContent = `${country.dial_code}`;
              countryCodeSelect.appendChild(option);
            });
          })
          .catch((error) =>
            console.error("Error loading country codes:", error)
          );

        phoneInput.addEventListener("input", () => {
          phoneError.textContent = phonePattern.test(phoneInput.value)
            ? ""
            : "Enter a valid 10-digit phone number*";
        });

        emailInput.addEventListener("input", () => {
          emailError.textContent = emailPattern.test(emailInput.value)
            ? ""
            : "Enter a valid email address*";
        });

        nextBtn.addEventListener("click", () => {
          if (
            !namePattern.test(nameInput.value) ||
            !phonePattern.test(phoneInput.value) ||
            !emailPattern.test(emailInput.value)
          ) {
            alert("Please complete the fields before proceeding.");
          } else {
            step1.classList.remove("active");
            step2.classList.add("active");
          }
        });

        backButton.addEventListener("click", () => {
          step2.classList.remove("active");
          step1.classList.add("active");
        });

        document
          .getElementById("step2Form")
          .addEventListener("submit", async function (event) {
            event.preventDefault();

            const countryCode = countryCodeSelect.value;
            const phoneNumber = phoneInput.value;
            const fullPhoneNumber = countryCode + phoneNumber;

            const category = document.getElementById("category").value;
            const ticketType = document.getElementById("ticketType").value;

            if (!ticketType) {
              alert("Please select a ticket type");
              return;
            }

            let ticketData = {};
            if (ticketType === "TEDx General") {
              ticketData = {
                ticket_id: "8622937a-e2f1-4e0f-9a2c-5c0b290b03b3",
                count: 1,
                my_ticket: true,
              };
            } else if (ticketType === "Farookians") {
              ticketData = {
                ticket_id: "b2497619-a185-4e10-b9c1-2610e3076a5c",
                count: 1,
                my_ticket: true,
              };
            }

            const formData = new FormData();
            formData.append("name", nameInput.value);
            formData.append("phone", fullPhoneNumber);
            formData.append("email", emailInput.value);
            formData.append("category", category);
            formData.append("tickets[]", JSON.stringify(ticketData));

            submitButton.disabled = true;
            submitButton.style.backgroundColor = "gray";
            submitButton.style.cursor = "not-allowed";

            try {
              const response = await fetch(
                "https://api.buildnship.in/makemypass/public-form/8b46f9ce-8d86-4806-abe2-7ec6710ba59a/submit/",
                {
                  method: "POST",
                  body: formData,
                }
              );

              const responseData = await response.json();

              if (
                responseData.hasError &&
                responseData.message?.general?.includes("Event is full")
              ) {
                errorMessage.textContent = "Event is full";
                errorMessage.style.display = "block";
                return;
              }

              if (response.ok && !responseData.hasError) {
                const order = responseData.response;
                const options = {
                  key: order.gateway_key,
                  amount: order.amount,
                  currency: order.currency,
                  order_id: order.id,
                  handler: async function (paymentResponse) {
                    const paymentData = {
                      order_id: paymentResponse.razorpay_order_id,
                      payment_id: paymentResponse.razorpay_payment_id,
                    };

                    const validationResponse = await fetch(
                      "https://api.buildnship.in/makemypass/public-form/validate-payment/",
                      {
                        method: "POST",
                        headers: {
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify(paymentData),
                      }
                    );

                    const validationResult = await validationResponse.json();

                    if (validationResponse.ok && !validationResult.hasError) {
                      alert("Payment verified and successful!");
                    } else {
                      alert(
                        "Payment verification failed: " +
                          (validationResult.message || "Unknown error")
                      );
                    }
                  },
                  theme: {
                    color: "#F37254",
                  },
                };

                const rzp = new Razorpay(options);
                rzp.open();
              } else if ((order.response = {})) {
                console.log();
              } else {
                const errorMessage =
                  responseData.response.message?.email?.[0] ||
                  "An error occurred. Please try again.";
                alert("Error: " + errorMessage);
              }
            } catch (error) {
              console.error("Network error:", error);
              alert("There was a network error. Please try again.");
            } finally {
              submitButton.disabled = false;
              submitButton.style.backgroundColor = "red";
              submitButton.style.cursor = "allowed";
            }
          });
      });
    </script>
  </body>
</html>
